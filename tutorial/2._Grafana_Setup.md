## Grafana

In your browser nagivate to http://localhost:3000/. The default login is `admin`/`admin`.

1. Click `Add your first data source`.

<img src="./assets/grafana_1.png" alt="grafana dashboard setup">

2. Select `Prometheus` as the data source.

<img src="./assets/grafana_2.png" alt="grafana dashboard setup">

3. Type http://prometheus:9090 in the URL field. Prometheus reflects the name of the service in the `docker-compose.yml` file.

<img src="./assets/grafana_3.png" alt="grafana dashboard setup">

4. Scroll down and click `Save & Test`. After you click, you should see the following message on the same page: `Successfully queried the Prometheus API`. In that case click on `building a dashboard`.

<img src="./assets/grafana_4.png" alt="grafana dashboard setup">

5. Click on `+ Add visualization`.

<img src="./assets/grafana_5.png" alt="grafana dashboard setup">


6. Click on the one one available data source:

<img src="./assets/grafana_6.png" alt="grafana dashboard setup">


7. Change the default visualization type from `Time Series` to `Stat`. 

<img src="./assets/grafana_7.png" alt="grafana dashboard setup">

8. Search in the `Metrics` browser. You could search for `whoknows_cpu_load_percent`, `whoknows_http_responses_total` or `whoknows_request_duration_milliseconds`. These are the metrics that have been set up in `app.py`. 

<img src="./assets/grafana_8.png" alt="grafana dashboard setup">

8. You can click `Run Queries` to check out the result. Click `Apply`. (The blue button in the top right)

9. To save the dashboard, click on the `Save` icon. Give the dashboard a name and click `Save`.

<img src="./assets/grafana_9.png" alt="grafana dashboard setup">

10. Click `Add` and `Visualization` to keep adding panels to the dashboard. You can give them titles. 

<img src="./assets/grafana_10.png" alt="grafana dashboard setup">

<img src="./assets/grafana_11.png" alt="grafana dashboard setup">

11. Remember to set the update interval to anything but `OFF`. Select `Auto` or match it with the Prometheus update interval.

<img src="./assets/grafana_13.png" alt="grafana dashboard setup">

12. Star the repository, for quicker access from the frontpage. 

<img src="./assets/grafana_14.png" alt="grafana dashboard setup">

Grafana has changed the UI a lot and setting the dashboard to be what appears on the Home page is not straightforward.

<img src="./assets/grafana_15.png" alt="grafana dashboard setup">

---

## [Highly Optional] Installing plugins for Grafana

If you would like to visualize the data in a different way than the default, you can install plugins for Grafana.

1. Go to the `Panel plugins for Grafana` page: https://grafana.com/grafana/plugins/panel-plugins/

2. Let's try it with this plugin: https://grafana.com/grafana/plugins/grafana-clock-panel/

3. First, log into (-it = interactive) the bash shell of the grafana instance. Verify it's name on your machine with `docker ps`. In my case it is `src-grafana-1`.:

```bash
$ docker exec -it src-grafana-1 /bin/bash
```

4. Once logged in run the install command, see the success message and typee `exit` to leave the shell:

```bash
04830e2291c1:/usr/share/grafana$ grafana cli plugins install grafana-clock-panel
âœ” Downloaded and extracted grafana-clock-panel v2.0.1 zip successfully to /var/lib/grafana/plugins/grafana-clock-panel

Please restart Grafana after installing or removing plugins. Refer to Grafana documentation for instructions if necessary.
04830e2291c1:/usr/share/grafana$ exit
exit
```

The exact command can be found on the installation tab:

https://grafana.com/grafana/plugins/grafana-clock-panel/?tab=installation

5. Restart the Grafana service. In mycase, where it is named `src-grafana-1`:

```bash
$ docker restart src-grafana-1
```

6. After restarting the service, installed plugins should be available immediately. You always verify the installation by going to http://localhost:3000/plugins.

7. Go to your dashboard, click `Add` and `Visualization` and you should see the new plugin available. Search for `clock` and you should see the new plugin.

<img src="./assets/grafana_11.png" alt="grafana dashboard setup">

8. It's possible to style the background color, font size etc. in the options tab. 

9. Success! You have now installed a plugin for Grafana.

<img src="./assets/grafana_12.png" alt="grafana dashboard setup">


---

## [Highly Optional] Use a dashboard template

For this course I recommend that you create the dashboard yourselves so that you make conscious decisions on what to display. But it's possible to find and import dashboards from here:

https://grafana.com/grafana/dashboards/

---

## Codify your creation

Make sure to turn your Grafana configuration into code, so that you do not go through the manual setup:

Search for "Grafana Predefined Dashboards":

https://runkiss.blogspot.com/2020/01/using-prometheus-grafana-to-monitor.html

Or you can build a custom Grafana image:

https://grafana.com/docs/grafana/latest/setup-grafana/configure-docker/#build-a-custom-grafana-docker-image 
