# Generating a CR_PAT (Container Registry Personal Access Token)

You can read more about personal access tokens on Github here:

https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens

To deploy to Github Packages (Github's own container registry) via. Github Actions, you need a personal access token.

It is a convention to call the token for accessing Github Packages CR_PAT (Container Registry Personal Access Token). I will do that from now on in this tutorial.

Github has a new default type of token:

1. Fine-grained personal access tokens

It is usually preferred to use Fine-grained tokens. These offer better security and control. In the past, Fine-grained tokens did not allow read and write permissions to "Packages", but that has changed.

Now it is possible to grant read and write access to Packages when creating a Fine-grained token. This makes it suitable for publishing packages to Github Packages.

---

# How to generate a CR_PAT (Container Registry Personal Access Token)

We are going to create a **Fine-grained personal access token**: https://github.com/settings/personal-access-tokens

This access token will be created on your personal account. It is used to authenticate (logging in) to the container registry. For organisations you must allow the organisation to accept personal access tokens (PATs).

## Step 1: Create a policy for your organisation to accept PATs

https://docs.github.com/en/organizations/managing-programmatic-access-to-your-organization/setting-a-personal-access-token-policy-for-your-organization

https://www.youtube.com/watch?v=T-eqWEUdjeM

## Step 2: Generate a PAT

As the name implies (Personal Access) this should be done on your personal account.

https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token

Before clicking **Generate token** choose the **Resource owner** as the organisation you want to give access to.

For better security, you can also choose specific repositories that it has access to. 

Set Repository Permissions  
You will need to set the following Repository and Organization permissions:
	•	Contents: Read and Write  
	•	Metadata: Read-only  
	•	Actions: Read and Write  
	•	Deployments: Read and Write (necessary for some deployment actions)  
	•	Environments: Read and Write (necessary for managing environments and secrets)  
	•	Packages: Read and Write (required for publishing to Github Packages)  

Copy the token. 

(The user must have write access to the repository. This is not automatic even if the user has created the organisation. It can be setup in the repository settings -> Collaborators and teams -> Manage access and click **Add people**.)

## Step 3 (Optional): Verify that the token is on the repository. 

1. Go to the repository settings page.

2. On the left choose **Personal access tokens** and **Active tokens** under it. The token should now appear in the list. 

Under **Organization permissions** it should have green check marks for the following:

✅ Read and Write access to organization administration  

And under **Repository permissions** it should have green check marks for the following:

✅ Read access to metadata  
✅ Read and Write access to actions and code  
✅ Read and Write access to packages  

---

# Validating the CR_PAT

In the root of this branch there is a script named [is_valid_crpat.sh](../is_valid_crpat.sh). It can be used to validate the CR_PAT.

The script will take your CR_PAT and test whether it has permission to push packages to a given repository.

Make sure not to choose `Y` when asked to use this repository unless this is the actual target. Either:

1. Paste the URL of the repository you want to deploy to when prompted.

2. Move the script to the target repository and let it automatically extract the URL from there.

